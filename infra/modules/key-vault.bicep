// Azure Key Vault module for secrets management\n@description('Key Vault name')\nparam name string\n\n@description('Location for Key Vault')\nparam location string\n\n@description('Environment name')\nparam environmentName string\n\n@description('Functions App principal ID for access policy')\nparam functionsAppPrincipalId string\n\n// Key Vault resource\nresource keyVault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: name\n  location: location\n  tags: {\n    Environment: environmentName\n    Application: 'CodeQL-Compliance-Dashboard'\n    ManagedBy: 'Bicep'\n  }\n  properties: {\n    tenantId: subscription().tenantId\n    sku: {\n      family: 'A'\n      name: 'standard'\n    }\n    // Enable for Azure Resource Manager deployment\n    enabledForDeployment: false\n    enabledForDiskEncryption: false\n    enabledForTemplateDeployment: true\n    // Enable soft delete and purge protection for production\n    enableSoftDelete: true\n    enablePurgeProtection: environmentName == 'prod'\n    softDeleteRetentionInDays: 7\n    // Network access rules\n    networkAcls: {\n      defaultAction: 'Allow' // Restrict in production\n      bypass: 'AzureServices'\n    }\n    // Access policies\n    accessPolicies: [\n      {\n        tenantId: subscription().tenantId\n        objectId: functionsAppPrincipalId\n        permissions: {\n          secrets: [\n            'get'\n            'list'\n          ]\n          keys: [\n            'get'\n            'list'\n          ]\n          certificates: [\n            'get'\n            'list'\n          ]\n        }\n      }\n    ]\n  }\n}\n\n// Placeholder secrets (will be populated manually or via CI/CD)\nresource githubAppPrivateKey 'Microsoft.KeyVault/vaults/secrets@2023-07-01' = {\n  parent: keyVault\n  name: 'github-app-private-key'\n  properties: {\n    value: 'placeholder-value' // Replace with actual private key\n    contentType: 'application/x-pem-file'\n    attributes: {\n      enabled: true\n    }\n  }\n}\n\nresource githubAppId 'Microsoft.KeyVault/vaults/secrets@2023-07-01' = {\n  parent: keyVault\n  name: 'github-app-id'\n  properties: {\n    value: 'placeholder-value' // Replace with actual app ID\n    attributes: {\n      enabled: true\n    }\n  }\n}\n\nresource githubInstallationId 'Microsoft.KeyVault/vaults/secrets@2023-07-01' = {\n  parent: keyVault\n  name: 'github-installation-id'\n  properties: {\n    value: 'placeholder-value' // Replace with actual installation ID\n    attributes: {\n      enabled: true\n    }\n  }\n}\n\n// Output values\noutput name string = keyVault.name\noutput id string = keyVault.id\noutput uri string = keyVault.properties.vaultUri
